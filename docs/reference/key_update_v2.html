<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Update existing key file to version 2 with additional information and
new features — key_update_v2 • soilHarmonization</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Update existing key file to version 2 with additional information and
new features — key_update_v2" />
<meta property="og:description" content="Early work with the SOM data indicated that additional details
about the data sets are required. To accomodate more detail, new additions
to the key file are needed. The key_update_v2 function addresses desired
changes to the key files. It is critical that information already entered
into key files was not lost, so the new key file features had to be added
to existing key file without information loss." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">soilHarmonization</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Update existing key file to version 2 with additional information and
new features</h1>
    
    <div class="hidden name"><code>key_update_v2.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Early work with the SOM data indicated that additional details
about the data sets are required. To accomodate more detail, new additions
to the key file are needed. The key_update_v2 function addresses desired
changes to the key files. It is critical that information already entered
into key files was not lost, so the new key file features had to be added
to existing key file without information loss.</p>
    </div>

    <pre class="usage"><span class='fu'>key_update_v2</span>(
  <span class='no'>sheetName</span>,
  <span class='kw'>keyFileDownloadPath</span> <span class='kw'>=</span> <span class='st'>"/home/shares/lter-som/key_file_download/"</span>,
  <span class='kw'>keyFileArchivePath</span> <span class='kw'>=</span> <span class='st'>"/home/shares/lter-som/key_file_archive/"</span>,
  <span class='kw'>keyFileUploadPath</span> <span class='kw'>=</span> <span class='st'>"/home/shares/lter-som/key_file_upload/"</span>,
  <span class='kw'>keyFileUpdateLogPath</span> <span class='kw'>=</span> <span class='st'>"/home/shares/lter-som/key_file_update_log.csv"</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>sheetName</th>
      <td><p>name of or https path to key file in Google Drive to update
with version 2 changes</p></td>
    </tr>
    <tr>
      <th>keyFileDownloadPath</th>
      <td><p>a intermediary directory to where the key file
from Google Drive may be downloaded for importing into the R environment</p></td>
    </tr>
    <tr>
      <th>keyFileArchivePath</th>
      <td><p>directory to where csv versions of the location and
profile tabs of the sheet to be updated will be archived</p></td>
    </tr>
    <tr>
      <th>keyFileUploadPath</th>
      <td><p>a intermediary directory to where the new key
workbook from the R environment can be saved for eventual upload to Google
Drive</p></td>
    </tr>
    <tr>
      <th>keyFileUpdateLogPath</th>
      <td><p>log file that catalogs the occurence of a
succesful update of a key file. This file must exist in advance of running
the update utility</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>key_update_v2 actions and output include: (1) csv versions of the
source key file location and profie tabs are written to a specified
directory; (2) a new key file is created with desired version 2
modifications; if successful, the key file update action is written to an
identified key file update log.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p><strong>key_update_v2 workflow:</strong></p><ol>
<li><p>download project key file with googledrive</p></li>
<li><p>load downloaded (now xlsx) into R with openxlsx::loadWorkbook (see note)</p></li>
<li><p>additions to the workbook object as needed</p></li>
<li><p>prescribe validations with openxlsx::dataValidation</p></li>
<li><p>fix styling as needed with openxlsx::createSytle/addStyle</p></li>
<li><p>write workbook back to file with openxlsx::write.xlsx (or saveWorkbook)</p></li>
<li><p>upload workbook back to project directory to be followed by a re-homog</p></li>
</ol>

<p>The workflow was getting hung up at step 2 in the workflow. The
solution was to use the development branch of the openxlsx package (see
https://github.com/awalker89/openxlsx/issues/386)
devtools::install_github("awalker89/openxlsx") Rcpp package is a dependency</p>
<p><strong>Key file version 2 new features include:</strong></p><ol>
<li><p>several new metadata fields in the location tab ('time_series',
'gradient', 'experiments', 'control_id', 'number_treatments',
'merge_align', 'key_version').</p></li>
<li><p>A new 'logical' column in the Units tab to facilitate a YES, NO
drop-down option for several of the new metadata fields added to the
location tab.</p></li>
<li><p>Revised options in the Units tab for the list of drop-down options in
the treatment rows of the Profile tab.</p></li>
<li><p>Add pull-down menu for units field of lit_lig in location tab.</p></li>
<li><p>Clarify meanings (Var_long field) of profle tab c_tot and soc (bulk, not
fraction).</p></li>
<li><p>Duplicate var values in the Location and Profile tabs are renamed with
unique names.</p></li>
</ol>

<p>Though specific to version 2 features, this workflow could be modified
to implement new features for future versions.</p>
<p>This workflow defaults to being run on Aurora with default file paths
set to that environment. These paths can be altered for the function to
work outside of the Aurora environemnt, but the lter-som group should not
do this as we need to document all changes, and a log file must exist.</p>
<p><strong>To establish or reset a keyfile update log:</strong></p><pre>  create template for logging details of key file upversions (caution: this code
  will overwrite an existing log)

  keyFileUpdateLogPath &amp;lt;- '/home/shares/lter-som/key_file_update_log.csv'

  tibble(
    keyFileName = as.character(NA),
    keyFileDirectory = as.character(NA),
    timestamp = as.POSIXct(NA)
  ) %&amp;gt;%
  write_csv(path = keyFileUpdateLogPath, append = FALSE)

</pre>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Stevan Earl, Derek Pierson, William Wieder.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


