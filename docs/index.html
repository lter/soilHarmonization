<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Homogenize LTER Soil Organic Matter Working Group data and notes • soilHarmonization</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Homogenize LTER Soil Organic Matter Working Group data and notes">
<meta property="og:description" content="Imports data and a key
    translation file from a Google Directory that the user is able to access.
    Data are homogenized to feature common header names and units, and
    dataset-level notes appended to each data file. Output includes
    standardized data and notes to a local directory on the user's computer
    that are also uploaded to the Google Directory identified by the user as
    containing the source data and key translation file. Modified data are
    appeneded with the string &quot;HMGZD&quot;.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">soilHarmonization</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="soilharmonization" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#soilharmonization" class="anchor"></a>soilHarmonization</h1></div>
<!-- README.md is generated from README.Rmd. Please edit the latter. -->
<div id="overview" class="section level3">
<h3 class="hasAnchor">
<a href="#overview" class="anchor"></a>overview</h3>
<p><code>soilHarmonization</code> is an R package to aid the harmonization of data (and notes about data) for the LTER Soil Organic Matter (SOM) Working Group synthesis effort. This working group is examining SOM and other soil-related variables to evaluate competing theories that underlie models of soil dynamics.</p>
<p>Data provided by working group participants and other data sources are aggregated into a project Google Drive. Though all related to soils, these data vary vastly in their structure, units of measure, granularity and other details. To facilitate their use in models, the data must be homogenized to a sufficient degree such that cross-site, -project, -time comparisons are feasible.</p>
<p>To facilitate data harmonization, data providers are tasked with generating a <em>key file</em> that serves as a guide to translate the user-provided data into a common, project-wide structure and format. For each data set provided, the key file should contain general details about the data provider, the project from which the data were generated, and generalized details that apply to the data broadly (e.g., mean annual precipitation at the study site). Such generalized information is referred to as <em>location</em> or <em>locational</em> data in this project. At a finer resolution, the key file should contain mappings between the provided data and common terminology and units employed by the project for that data type. For example, the project-designated term for the standing stock of soil organic matter is <code>soc_stock</code> in units of g/m<sup>2</sup>. If the provided data included information about the standing stock of soil organic matter in a column titled <code>soil C</code> with units of %, that translation will be noted by the data provided on the Profile_data tab of the key file. When run, the script will rename the column titled <code>soil C</code> to <code>som_stock</code> and apply the appropriate units conversion.</p>
<p>Each data set resides in its own subdirectory on the project Google Drive directory. Data providers must provide a key file for each data set.</p>
</div>
<div id="application" class="section level3">
<h3 class="hasAnchor">
<a href="#application" class="anchor"></a>application</h3>
<p>Please contact package authors for instructions on providing appropriate metadata.</p>
</div>
<div id="navigation" class="section level3">
<h3 class="hasAnchor">
<a href="#navigation" class="anchor"></a>navigation</h3>
<ul>
<li><a href="https://github.com/lter/soilHarmonization#installation">installation</a></li>
<li><a href="https://github.com/lter/soilHarmonization#data-homogenization">data-homogenization</a></li>
<li><a href="https://github.com/lter/soilHarmonization#homogenization-qc">homogenization-QC</a></li>
<li><a href="https://github.com/lter/soilHarmonization#keyfile-upversion">keyfile-upversion</a></li>
<li><a href="https://github.com/lter/soilHarmonization#acknowledgements">acknowledgements</a></li>
</ul>
</div>
<div id="installation" class="section level3">
<h3 class="hasAnchor">
<a href="#installation" class="anchor"></a>installation</h3>
<p>Install the current version from GitHub (after installing the <code>devtools</code> package from CRAN):</p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"lter/soilHarmonization"</span>)</pre></div>
<p>Users need also to have LaTeX installed. LaTeX is not an R package, and must be installed on the machine that will be running the script independently of R. The <a href="https://www.latex-project.org/">LaTeX project</a> is a good resource for installing LaTeX.</p>
</div>
<div id="data-homogenization" class="section level3">
<h3 class="hasAnchor">
<a href="#data-homogenization" class="anchor"></a>data-homogenization</h3>
<p>The <code>data_homogenization</code> script takes two input parameters: <code>directoryName</code> and <code>temporaryDirectory</code>. <code>directoryName</code> is the URL of the target Google Drive directory where the data and key file are located. Note that you must have read + write access to the target directory, and all <strong>data files must be Google Sheets</strong> (convert from Excel as necessary). <code>temporaryDirectory</code> is the quoted name and path of a directory on your local computer where the script will write output before uploading to the target Google Drive directory from which the data and key file were accessed. Script output includes a notes file and homogenized versions of the all provided data, each appended with <em>HMGZD</em> in the file names.</p>
<p>Special notes about the <code>temporarydirectory</code>:</p>
<ul>
<li>the full-path should be provided (e.g., ‘/path/cdr_output/’)</li>
<li>the directory name should feature a trailing forward (Linux, Mac) or backward (Windows) slash (but the script should add this if not provided)</li>
<li>the script will create the directory if it does not exist</li>
<li>the same <code>temporaryDirectory</code> can be used for multiple iterations but the script will delete any content so be sure to move or back up files in the <code>temporaryDirectory</code> that you wish to save</li>
</ul>
<p><strong>running the homogenization function, example:</strong></p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="fu"><a href="reference/data_homogenization.html">data_homogenization</a></span>(<span class="kw">directoryName</span> <span class="kw">=</span> <span class="no">URL</span>-<span class="no">of</span>-<span class="no">Google</span>-<span class="no">Directory</span>,
                    <span class="kw">temporaryDirectory</span> <span class="kw">=</span> <span class="st">'~/path/luq_homogenized'</span>)</pre></div>
</div>
<div id="homogenization-qc" class="section level3">
<h3 class="hasAnchor">
<a href="#homogenization-qc" class="anchor"></a>homogenization-QC</h3>
<p><strong>The QC functionality has been incorporated into the homogenization process. As such, homogenization-QC has been archived with the following details retained only for documentation.</strong></p>
<p>Revised versions of the <code>data-homogenization</code> function feature quality-control checks. As a result, the <code>homogenization_QC</code> function is available but largely unnecessary.</p>
<p>Following successful application of the <code>data_homogenization</code> script, a quality-control function (<code>homogenization_QC</code>) may be used to assess some aspects of the data homogeniztion process. <code>homogenization_QC</code> performs three Q-C checks: (1) reports the number of rows in the provided data file(s) and homogenized data file(s); (2) evalutes whether all location data provided in the key file were successfully incorporated into the homogenized data files(s); and (3) confirms that all profile-level variables entered into the key file were included in the homogenized data with a summary of those variables. In addition, the script generates plots all treatment and experimental (i.e., considered independent) variables identified in the key file against all dependent variables identified in the key file. Box plots are generated when the independent variable is categorical whereas scatter plots are generated when the independent variable is numeric. Please keep in mind that the plots are to provide only a general, visual assessment and comparison of the data provided for error-checking purposes, and are not intended to be exhaustive or of publication quality.</p>
<p>As with the <code>data_homogenization</code> script, <code>homogenization_QC</code> takes two input parameters: <code>directoryName</code> and <code>temporaryDirectory</code>. <code>directoryName</code> is the quoted the name of the target Google Drive directory where the data, key file, and now homogenized data and notes are located. Note that you must have read + write access to the target directory. <code>temporaryDirectory</code> is the quoted name and path of a directory on your local computer where the script will write output before uploading to the target Google Drive directory from which the files were accessed. Script output is a single html file with a file name generated from the temporaryDirectory and directoryName, and appended with “_HMGZD_QC.html”. Please note that html files do not render properly if opended in Google Drive, so the file should be downloaded and opened using a web browser, or viewed from the <code>temporaryDirectory</code> where a copy of the file will also reside.</p>
<p>Special notes about the <code>temporarydirectory</code>:</p>
<ul>
<li>the full-path should be provided (e.g., ‘/home/desktop/cdr_output/’)</li>
<li>the directory name should feature a trailing forward (Linux, Mac) or backward (Windows) slash (but the script should add this if not provided) the script will create the directory if it does not exist the same <code>temporaryDirectory</code> can be used for multiple iterations but the script will delete any content so be sure to move or back up files in the <code>temporaryDirectory</code> that you wish to save</li>
</ul>
<p><strong>running the quality-control function, example:</strong></p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="fu">homogenization_QC</span>(<span class="kw">directoryName</span> <span class="kw">=</span> <span class="st">'Luquillo elevation gradient'</span>,
                  <span class="kw">temporaryDirectory</span> <span class="kw">=</span> <span class="st">'~/Desktop/luq_homogenized'</span>)</pre></div>
</div>
<div id="keyfile-upversion" class="section level3">
<h3 class="hasAnchor">
<a href="#keyfile-upversion" class="anchor"></a>keyfile-upversion</h3>
<p><strong>this is an administrative function for SoDaH mainters and not relevant to SoDaH users</strong></p>
<p>Early work with the SOM data indicated that additional details about the data sets are required. To accomodate more detail, new additions to the key file are needed. The key_update_v2 function addresses desired changes to the key files. It is critical that information already entered into key files was not lost, so the new key file features had to be added to existing key file without information loss.</p>
<p><em>key_update_v2 workflow:</em></p>
<ol>
<li>download project key file with googledrive</li>
<li>load downloaded (now xlsx) into R with openxlsx::loadWorkbook (see note)</li>
<li>additions to the workbook object as needed</li>
<li>prescribe validations with openxlsx::dataValidation</li>
<li>fix styling as needed with openxlsx::createSytle/addStyle</li>
<li>write workbook back to file with openxlsx::write.xlsx (or saveWorkbook)</li>
<li>upload workbook back to project directory to be followed by a re-homog</li>
</ol>
<p><em>Key file version 2 new features include:</em></p>
<ol>
<li>several new metadata fields in the location tab (‘time_series’, ‘gradient’, ‘experiments’, ‘control_id’, ‘number_treatments’, ‘merge_align’, ‘key_version’).</li>
<li>A new ‘logical’ column in the Units tab to facilitate a YES, NO drop-down option for several of the new metadata fields added to the location tab.</li>
<li>Revised options in the Units tab for the list of drop-down options in the treatment rows of the Profile tab.</li>
<li>Add pull-down menu for units field of lit_lig in location tab.</li>
<li>Clarify meanings (Var_long field) of profle tab c_tot and soc (bulk, not fraction).</li>
<li>Duplicate var values in the Location and Profile tabs are renamed with unique names.</li>
</ol>
<p>This workflow defaults to being run on Aurora with default file paths set to that environment, though the paths can be altered for the function to work outside of the Aurora environment.</p>
<p><strong>Update 2019-05-31</strong>: Interaction with the Google API is becoming increasingly problematic. The script is no updated to not upload the updated key file version 2 Google Drive. Instead, users should modify the key file written to the key_file_upload/ directory using LibreOffice, then upload manually to the appropriate Google Drive directory.</p>
<p><strong>Update 2019-01-09</strong>: upon migrating Aurora to Ubuntu 18.04, approximately 20% of the calls to the Google API through the googlesheets and googledrive packages result in a curl error (<code>Error in curl::curl_fetch_memory(url, handle = handle) : Error in the HTTP2 framing layer</code>). Given the heavy dependence of these functions on calls to the Google API, working in Aurora is now problematic. Instead, users should run the scripts from a local machine (preferably not running Ubuntu &gt;= 18.04). Paths to download, achive, and upload directories are required but the path to a log file is optional. When run locally, the fate of original key file location and profile tabs downloaded as type csv in the archive directory are at the discretion of the user.</p>
<p><strong>running the key file update to version 2 function, example:</strong></p>
<p>If run on Auora, paths to download, achive, and upload directories, and to a log file are provided to the function by default.</p>
<div class="sourceCode" id="cb4"><pre class="r"><span class="fu"><a href="reference/key_update_v2.html">key_update_v2</a></span>(<span class="st">'621_Key_Key_test'</span>)</pre></div>
<p>However, if not running on Aurora, all directory-related parameters must be passed (the path to a key file log is optional).</p>
<div class="sourceCode" id="cb5"><pre class="r"><span class="fu"><a href="reference/key_update_v2.html">key_update_v2</a></span>(<span class="kw">sheetName</span> <span class="kw">=</span> <span class="st">'cap.557.Key_Key_master'</span>,
              <span class="kw">keyFileDownloadPath</span> <span class="kw">=</span> <span class="st">'~/Desktop/somdev/key_file_download/'</span>,
              <span class="kw">keyFileArchivePath</span> <span class="kw">=</span> <span class="st">'~/Desktop/somdev/key_file_archive/'</span>,
              <span class="kw">keyFileUploadPath</span> <span class="kw">=</span> <span class="st">'~/Desktop/somdev/key_file_upload/'</span>)</pre></div>
<p>Example with path to keyFileUpdateLog - the log must exist at the specified location.</p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="fu"><a href="reference/key_update_v2.html">key_update_v2</a></span>(<span class="kw">sheetName</span> <span class="kw">=</span> <span class="st">'cap.557.Key_Key_master'</span>,
              <span class="kw">keyFileDownloadPath</span> <span class="kw">=</span> <span class="st">'~/Desktop/somdev/key_file_download/'</span>,
              <span class="kw">keyFileArchivePath</span> <span class="kw">=</span> <span class="st">'~/Desktop/somdev/key_file_archive/'</span>,
              <span class="kw">keyFileUploadPath</span> <span class="kw">=</span> <span class="st">'~/Desktop/somdev/key_file_upload/'</span>,
              <span class="kw">keyFileUpdateLogPath</span> <span class="kw">=</span> <span class="st">'~/Desktop/keyUpdateLogFile.csv'</span> )</pre></div>
<p>If writing to a log file, required column names include: keyFileName, keyFileDirectory, and timestamp. Following is an example of how to create a empty log file. Pass the path to the <code>keyFileUpdateLogPath</code> parameter in the key_update_v2 function.</p>
<div class="sourceCode" id="cb7"><pre class="r"><span class="fu">tibble</span>(
  <span class="kw">keyFileName</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fl">NA</span>),
  <span class="kw">keyFileDirectory</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fl">NA</span>),
  <span class="kw">timestamp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span>(<span class="fl">NA</span>)
) <span class="kw">%&gt;%</span>
<span class="fu">write_csv</span>(<span class="kw">path</span> <span class="kw">=</span> <span class="st">'path/filename.csv'</span>, <span class="kw">append</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></div>
</div>
<div id="acknowledgements" class="section level3">
<h3 class="hasAnchor">
<a href="#acknowledgements" class="anchor"></a>acknowledgements</h3>
<ul>
<li>National Science Foundation under grant number DEB-1832016, Central Arizona–Phoenix Long-Term Ecological Research Program (CAP LTER)</li>
<li>Soil Organic Matter Synthesis Group supported through the Long Term Ecological Research Network Office (LNO) (NSF award numbers 1545288 and 1929393) and the National Center for Ecological Analysis and Synthesis (UCSB)</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Stevan Earl <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/https://orcid.org/0000-0002-4465-452X" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Derek Pierson <br><small class="roles"> Author </small> <a href="https://orcid.org/https://orcid.org/0000-0003-3413-1693" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>William Wieder <br><small class="roles"> Author </small> <a href="https://orcid.org/https://orcid.org/0000-0001-7116-1985" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Stevan Earl, Derek Pierson, William Wieder.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
